---
phase: 01-flashscore-usa-migration
plan: "02"
type: execute
wave: 2
depends_on:
  - 01-01
files_modified:
  - scripts/validate-flashscore-schema.mjs
  - package.json
  - README.md
  - src/files/json/index.js
  - src/files/csv/index.js
autonomous: true
requirements:
  - DATA-01
must_haves:
  truths:
    - "Generated JSON and CSV outputs preserve expected top-level and nested match fields"
    - "Migration includes an automated compatibility check path for future selector changes"
  artifacts:
    - "scripts/validate-flashscore-schema.mjs verifies expected match payload keys"
    - "package.json contains a runnable schema validation script command"
    - "README documents how to run compatibility validation"
  key_links:
    - "scraped match object -> file writers -> schema validator"
    - "validation script command -> developer migration verification workflow"
---

<objective>
Add compatibility verification so the USA selector migration can be validated against expected output structure.

Purpose: Ensure the migration does not silently break downstream consumers relying on existing JSON/CSV schemas.
Output: Executable schema validation script, package command wiring, and updated usage docs.
</objective>

<execution_context>
@./.codex/get-shit-done/workflows/execute-plan.md
@./.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-flashscore-usa-migration/01-CONTEXT.md
@.planning/phases/01-flashscore-usa-migration/01-RESEARCH.md
@.planning/phases/01-flashscore-usa-migration/01-01-SUMMARY.md

@src/files/json/index.js
@src/files/csv/index.js
@README.md
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create output schema compatibility validator</name>
  <files>scripts/validate-flashscore-schema.mjs</files>
  <action>Create a Node script that reads a generated JSON output file (object or array variants), inspects one or more match entries, and validates required keys and nested fields used by current consumers. Fail with non-zero exit code and explicit missing-field messages when schema drift is detected.</action>
  <verify><automated>node --check scripts/validate-flashscore-schema.mjs</automated></verify>
  <done>Validator script exists, compiles, and reports pass/fail deterministically for required fields.</done>
</task>

<task type="auto">
  <name>Task 2: Wire validator into developer workflow</name>
  <files>package.json, README.md</files>
  <action>Add a script command (for example `validate:schema`) that runs the validator and document usage in README migration/usage sections. Include example invocation against a generated output file. Keep existing start command unchanged.</action>
  <verify><automated>node -e "const p=require('./package.json'); if(!p.scripts || !p.scripts['validate:schema']) process.exit(1);"</automated></verify>
  <done>Developers can run one command to validate schema compatibility after scraping.</done>
</task>

<task type="auto">
  <name>Task 3: Confirm writer compatibility assumptions remain valid</name>
  <files>src/files/json/index.js, src/files/csv/index.js</files>
  <action>Review and adjust writer edge handling only if needed to preserve compatibility with migrated extraction outputs (object/array JSON and flattened CSV transforms). Avoid changing output contract semantics; only add defensive handling where migration introduces nullable edge cases.</action>
  <verify><automated>node --check src/files/json/index.js && node --check src/files/csv/index.js</automated></verify>
  <done>Writers remain compatible with required field expectations and compile cleanly.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run validate:schema -- src/data/<sample-output>.json` passes on a post-migration sample
- [ ] `node --check src/files/json/index.js src/files/csv/index.js scripts/validate-flashscore-schema.mjs`
- [ ] README contains validation instructions for migration verification
</verification>

<success_criteria>

- All plan tasks completed
- Schema validator detects missing required fields with clear failure output
- Validation command is documented and runnable
- Output schema compatibility is explicitly checked as part of migration workflow
</success_criteria>

<output>
After completion, create `.planning/phases/01-flashscore-usa-migration/01-02-SUMMARY.md`
</output>
