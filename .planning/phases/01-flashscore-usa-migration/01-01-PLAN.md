---
phase: 01-flashscore-usa-migration
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - src/constants/index.js
  - src/cli/prompts/index.js
  - src/scraper/services/countries/index.js
  - src/scraper/services/leagues/index.js
  - src/scraper/services/seasons/index.js
  - src/scraper/services/matches/index.js
autonomous: true
requirements:
  - CORE-01
  - SCRP-01
  - SCRP-02
must_haves:
  truths:
    - "CLI-driven scraping uses flashscoreusa.com routes end-to-end"
    - "Country/league/season options resolve from USA domain pages"
    - "Match lists and match detail/statistics extraction work on USA pages"
  artifacts:
    - "src/constants/index.js defines BASE_URL as https://www.flashscoreusa.com"
    - "Discovery services use selectors compatible with USA DOM structure"
    - "Match service extracts IDs/URLs, summary, and stats via updated selectors"
  key_links:
    - "prompt season URL builder -> BASE_URL -> scraper navigation"
    - "match link discovery selectors -> getMatchData URL pipeline"
    - "summary page extraction -> stats page extraction"
---

<objective>
Migrate domain and scraping selectors to Flashscore USA in all discovery and match extraction services.

Purpose: Implement the core functional migration so scraping requests hit the reliable domain and use compatible DOM selectors.
Output: Updated constants, URL builders, and selector logic in country/league/season/match services.
</objective>

<execution_context>
@./.codex/get-shit-done/workflows/execute-plan.md
@./.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-flashscore-usa-migration/01-CONTEXT.md
@.planning/phases/01-flashscore-usa-migration/01-RESEARCH.md

@src/constants/index.js
@src/cli/prompts/index.js
@src/scraper/services/countries/index.js
@src/scraper/services/leagues/index.js
@src/scraper/services/seasons/index.js
@src/scraper/services/matches/index.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Switch base domain and harden route composition</name>
  <files>src/constants/index.js, src/cli/prompts/index.js</files>
  <action>Change `BASE_URL` to `https://www.flashscoreusa.com` and update any route composition paths that still assume the old domain. Ensure direct league-season URL generation remains lowercased and composes correctly with the new origin. Do not change CLI argument names or output file naming behavior.</action>
  <verify><automated>rg -n "flashscoreusa.com|flashscore.com" src/constants/index.js src/cli/prompts/index.js</automated></verify>
  <done>All active routing references point to the USA domain and old domain references are removed from runtime path composition.</done>
</task>

<task type="auto">
  <name>Task 2: Update discovery selectors for countries, leagues, and seasons</name>
  <files>src/scraper/services/countries/index.js, src/scraper/services/leagues/index.js, src/scraper/services/seasons/index.js</files>
  <action>Update selectors and extraction logic to match Flashscore USA discovery pages. Prefer resilient selector patterns (fallback selectors or semantic targeting) over deep rigid CSS chains where possible. Keep the returned object contracts unchanged (`name`, `url`, `id` where applicable).</action>
  <verify><automated>node --check src/scraper/services/countries/index.js && node --check src/scraper/services/leagues/index.js && node --check src/scraper/services/seasons/index.js</automated></verify>
  <done>Country, league, and season services compile and retain their existing return data shapes while using USA-compatible selectors.</done>
</task>

<task type="auto">
  <name>Task 3: Update match selectors and protect stats URL flow</name>
  <files>src/scraper/services/matches/index.js</files>
  <action>Adjust match list/detail/statistics selectors to the USA domain markup and keep extraction keys stable (`stage`, `date`, `status`, `home`, `away`, `result`, `information`, `statistics`). Add defensive handling for missing match URLs or missing `mid` values so stats navigation cannot crash on malformed entries.</action>
  <verify><automated>node --check src/scraper/services/matches/index.js</automated></verify>
  <done>Match scraping module compiles with updated USA selectors and gracefully handles missing URL/stat parameters without breaking batch execution.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `node --check src/constants/index.js src/cli/prompts/index.js src/scraper/services/countries/index.js src/scraper/services/leagues/index.js src/scraper/services/seasons/index.js src/scraper/services/matches/index.js`
- [ ] `rg -n "flashscoreusa.com" src/`
- [ ] A one-league smoke run reaches country/league/season and collects match links without domain mismatch errors
</verification>

<success_criteria>

- All plan tasks completed
- Updated services compile without syntax errors
- USA domain is used across discovery and match scraping paths
- Data extraction keys remain backward compatible with current writer expectations
</success_criteria>

<output>
After completion, create `.planning/phases/01-flashscore-usa-migration/01-01-SUMMARY.md`
</output>
