---
phase: 08-reliability-trend-summaries
plan: "02"
type: execute
wave: 2
depends_on:
  - 08-01
files_modified:
  - scripts/reliability-trends.mjs
  - src/cli/arguments/index.js
  - src/reliability/trends/reporting.js
  - .github/workflows/reliability-smoke.yml
  - package.json
  - README.md
autonomous: true
requirements:
  - RELY-11
must_haves:
  truths:
    - "Operators can run a dedicated command to generate trend summaries with configurable lookback windows"
    - "Trend summary output is persisted as reusable artifacts for both local troubleshooting and CI runs"
    - "Command output and artifacts clearly indicate data coverage gaps when history is missing or partial"
  artifacts:
    - "scripts/reliability-trends.mjs provides operator-facing trend summary command orchestration"
    - "src/cli/arguments/index.js parses trend-summary lookback/output options with validation"
    - "src/reliability/trends/reporting.js persists latest + history trend artifacts and handles retention"
    - ".github/workflows/reliability-smoke.yml runs trend summary generation and uploads trend artifacts"
    - "package.json exposes npm script entrypoint for local and CI usage"
    - "README.md documents command usage, output contract, and diagnostics interpretation"
  key_links:
    - "CLI options -> trend summary API -> aggregated fixture/region metrics for the chosen window"
    - "trend summary result -> reporting persistence -> latest/history artifacts consumed by operators and CI"
    - "CI workflow execution -> trend command invocation -> uploaded reliability trend artifact bundle"
---

<objective>
Deliver the operator-facing trend summary command and artifact contract.

Purpose: Make reliability trend summaries easy to run locally and automatically in CI with reusable output artifacts.
Output: CLI script + argument parser + persistence/reporting + workflow integration + documentation.
</objective>

<execution_context>
@./.codex/get-shit-done/workflows/execute-plan.md
@./.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/STATE.md
@.planning/phases/08-reliability-trend-summaries/08-01-PLAN.md

@scripts/smoke-reliability.mjs
@scripts/health-selectors.mjs
@src/cli/arguments/index.js
@.github/workflows/reliability-smoke.yml
@README.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add reliability trend command with validated lookback and output options</name>
  <files>scripts/reliability-trends.mjs, src/cli/arguments/index.js, package.json</files>
  <action>Create a dedicated trend-summary command that calls the phase-8 aggregation API, accepts selectable lookback controls (`--lookback-hours` and optional source/path overrides), and prints concise fixture/region summary sections plus diagnostics lines. Add strict CLI validation for invalid lookback values and expose an npm script entrypoint (`trend:reliability`) for local and workflow use.</action>
  <verify><automated>node --check scripts/reliability-trends.mjs src/cli/arguments/index.js</automated></verify>
  <done>Operators can run one command to produce bounded-window trend summaries with validated inputs and stable exit behavior.</done>
</task>

<task type="auto">
  <name>Task 2: Persist trend summary artifacts and integrate CI generation/upload flow</name>
  <files>src/reliability/trends/reporting.js, scripts/reliability-trends.mjs, .github/workflows/reliability-smoke.yml</files>
  <action>Add trend-report persistence that writes `latest.json` plus timestamped history under `.planning/artifacts/reliability-trends/` with retention behavior aligned to existing reliability artifacts. Update CI workflow to execute trend summary generation after reliability checks and upload the trend artifact directory (always). Keep failure semantics explicit: trend command should still emit artifact + diagnostics even when source history is partial.</action>
  <verify><automated>node --check src/reliability/trends/reporting.js scripts/reliability-trends.mjs</automated></verify>
  <done>Trend summaries are persisted predictably in local and CI runs, and CI uploads them as reusable artifacts for operators.</done>
</task>

<task type="auto">
  <name>Task 3: Document trend output contract and troubleshooting workflow</name>
  <files>README.md, scripts/reliability-trends.mjs, .github/workflows/reliability-smoke.yml</files>
  <action>Document command usage, lookback examples, artifact locations, and the summary output contract fields (window, totals, byFixture, byRegion, diagnostics). Include operator guidance for interpreting missing/partial-history diagnostics and using CI-uploaded trend artifacts for investigation. Ensure docs match actual command flags and workflow behavior.</action>
  <verify><automated>rg -n \"trend:reliability|reliability trend|lookback|byFixture|byRegion|diagnostics|reliability-trends\" README.md package.json .github/workflows/reliability-smoke.yml scripts/reliability-trends.mjs</automated></verify>
  <done>Operators can run and interpret trend summaries without reading code, and CI/local usage paths remain aligned.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] node --check scripts/reliability-trends.mjs src/cli/arguments/index.js src/reliability/trends/reporting.js
- [ ] node scripts/reliability-trends.mjs --lookback-hours 168 --report /tmp/reliability-trends-phase8.json --quiet
- [ ] node -e "const fs=require('fs');const p='/tmp/reliability-trends-phase8.json';if(!fs.existsSync(p))process.exit(1);const j=JSON.parse(fs.readFileSync(p,'utf8'));if(!j.window||!j.totals||!Array.isArray(j.byFixture)||!Array.isArray(j.byRegion)||!j.diagnostics)process.exit(1);"
- [ ] rg -n \"reliability-trends|trend:reliability|lookback\" .github/workflows/reliability-smoke.yml README.md package.json scripts/reliability-trends.mjs
</verification>

<success_criteria>

- All plan tasks completed
- Operators can generate trend summaries from persisted artifacts with selectable lookback windows
- Trend output is persisted to stable local/CI artifact paths and includes grouped fixture/region metrics
- Missing or partial history is explicit in command output and artifact diagnostics
</success_criteria>

<output>
After completion, create .planning/phases/08-reliability-trend-summaries/08-02-SUMMARY.md
</output>
